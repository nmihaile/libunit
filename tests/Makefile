MAKEFLAGS +=	-s
NAME	=	unit_test
CC		=	cc
CFLAGS	=	-Wall -Wextra -Werror

SRCS	=	main.c \
			helper/ft_bus_error.c \
			helper/ft_abort_error.c \
			helper/ft_fpe_error.c \
			helper/ft_pipe_error.c \
			helper/ft_timeout_error.c \
			helper/ft_sigill_error.c \
			helper/ft_stdout_helper.c \
			demo/00_launcher.c \
			demo/01_ok_test.c \
			demo/02_ko_test.c \
			demo/03_sigsegv_test.c \
			demo/04_bus_error_test.c \
			demo/05_abort_test.c \
			demo/06_sigfpe_test.c \
			demo/07_pipe_test.c \
			demo/08_sigill_test.c \
			demo/09_timeout_test.c \
			demo/10_stdout_success_test.c \
			demo/11_stdout_error_test.c

OBJS	=	$(addprefix obj/, $(SRCS:.c=.o))

LIBFT	=	../libft/libft.a
LIBUNIT	=	../framework/libunit.a

all: $(LIBFT) $(LIBUNIT) $(NAME)

$(LIBFT):
	cd ../libft && $(MAKE) bonus

$(LIBUNIT):
	cd ../framework && $(MAKE)

$(NAME): $(OBJS)
	$(CC) $(CFLAGS) $(OBJS) $(LIBUNIT) $(LIBFT) -o $(NAME)

obj/%.o: %.c
	@mkdir -p $(dir $@)
	$(CC) $(CFLAGS) -c $< -o $@

clean:
	rm -rf obj/

fclean: clean
	rm -rf $(NAME)
	cd ../libft && $(MAKE) fclean
	cd ../framework && $(MAKE) fclean

re:
	$(MAKE) fclean
	$(MAKE) all

test: all
	@./$(NAME)

ret: re test
